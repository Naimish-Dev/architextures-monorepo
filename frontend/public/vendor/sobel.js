!function(root){"use strict";function Sobel(imageData){if(!(this instanceof Sobel))return new Sobel(imageData);var width=imageData.width,height=imageData.height,kernelX=[[-1,0,1],[-2,0,2],[-1,0,1]],kernelY=[[-1,-2,-1],[0,0,0],[1,2,1]],sobelData=[],grayscaleData=[];function bindPixelAt(data){return function(x,y,i){return data[4*(width*y+x)+(i=i||0)]}}var data,pixelAt=bindPixelAt(imageData.data),x,y;for(y=0;y<height;y++)for(x=0;x<width;x++){var r,g,b,avg=(pixelAt(x,y,0)+pixelAt(x,y,1)+pixelAt(x,y,2))/3;grayscaleData.push(avg,avg,avg,255)}for(pixelAt=bindPixelAt(grayscaleData),y=0;y<height;y++)for(x=0;x<width;x++){var pixelX=kernelX[0][0]*pixelAt(x-1,y-1)+kernelX[0][1]*pixelAt(x,y-1)+kernelX[0][2]*pixelAt(x+1,y-1)+kernelX[1][0]*pixelAt(x-1,y)+kernelX[1][1]*pixelAt(x,y)+kernelX[1][2]*pixelAt(x+1,y)+kernelX[2][0]*pixelAt(x-1,y+1)+kernelX[2][1]*pixelAt(x,y+1)+kernelX[2][2]*pixelAt(x+1,y+1),pixelY=kernelY[0][0]*pixelAt(x-1,y-1)+kernelY[0][1]*pixelAt(x,y-1)+kernelY[0][2]*pixelAt(x+1,y-1)+kernelY[1][0]*pixelAt(x-1,y)+kernelY[1][1]*pixelAt(x,y)+kernelY[1][2]*pixelAt(x+1,y)+kernelY[2][0]*pixelAt(x-1,y+1)+kernelY[2][1]*pixelAt(x,y+1)+kernelY[2][2]*pixelAt(x+1,y+1),magnitude=Math.sqrt(pixelX*pixelX+pixelY*pixelY)>>>0;sobelData.push(magnitude,magnitude,magnitude,255)}var clampedArray=sobelData;return"function"==typeof Uint8ClampedArray&&(clampedArray=new Uint8ClampedArray(sobelData)),clampedArray.toImageData=function(){return Sobel.toImageData(clampedArray,width,height)},clampedArray}function FakeImageData(data,width,height){return{width:width,height:height,data:data}}Sobel.toImageData=function toImageData(data,width,height){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(data))return new ImageData(data,width,height);if("object"==typeof window&&"object"==typeof window.document){var canvas=document.createElement("canvas");if("function"==typeof canvas.getContext){var context,imageData=canvas.getContext("2d").createImageData(width,height);return imageData.data.set(data),imageData}return new FakeImageData(data,width,height)}return new FakeImageData(data,width,height)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Sobel),exports.Sobel=Sobel):"function"==typeof define&&define.amd?define([],(function(){return Sobel})):root.Sobel=Sobel}(this);